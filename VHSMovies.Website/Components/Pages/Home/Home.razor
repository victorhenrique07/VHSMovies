@page "/"

@using MudBlazor
@using VHSMovies.Api.Integration.Main.Clients
@using VHSMovies.Api.Integration.Main.Responses
@using VHSMovies.Website.Components.Shared

@inject ITitlesClient titlesClient

@if (loading)
{
    <LoadingContainer />
}
else
{
    <MudContainer Class="position-relative">
        <HomeFeaturedMovie />
    </MudContainer>
    <MudDivider />

    <BackgroundStyle>
        <HomeTopics Titles="@mostRelevantSciFiTitles" TopicName="Most Relevant Sci-Fi Titles" />

        <HomeTopics Titles="@mostRelevantActionTitles" TopicName="Most Relevant Action Titles" />
    </BackgroundStyle>

    <style>
        .pt-10 {
            position: relative;
            background-image: url('@(websiteDetails is not null ? websiteDetails.BackgroundImage : string.Empty)');
            background-size: cover;
            background-position: center;
            @* background-attachment: fixed; *@
        }
    </style>
}

@code {
    [CascadingParameter]
    protected WebsiteDetails? websiteDetails { get; set; }

    private IReadOnlyCollection<TitleResponse> mostRelevantActionTitles;
    private IReadOnlyCollection<TitleResponse> mostRelevantSciFiTitles;

    int titleNumber = 0;

    private bool loading;

    protected override async Task OnInitializedAsync()
    {
        loading = true;

        int rankPosition = 1;

        mostRelevantActionTitles = await titlesClient.GetMostRelevantTitlesByGenre("action");

        mostRelevantSciFiTitles = await titlesClient.GetMostRelevantTitlesByGenre("science fiction");

        loading = false;
    }
}